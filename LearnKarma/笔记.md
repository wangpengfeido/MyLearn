## 安装
````
# Install Karma:
$ npm install karma --save-dev

# Install plugins that your project needs:
$ npm install karma-jasmine karma-chrome-launcher jasmine-core --save-dev
````
全局安装karma-cli后可以在cli中运行karma
````
$ npm install -g karma-cli
````

## 原理
karma本质上时一个web服务器工具，它针对连接上的每个浏览器一起运行源代码和测试代码。每段代码的每个浏览器上的测试结果通过命令行显示给开发者，开发者就能知道测试通过或失败。

浏览器的捕捉方式有：
* 通常，在浏览器中访问karma的服务地址
* 或者，让karma知道运行时启动哪个浏览器

karma监听在配置文件中配置的文件，当文件改变，发送信号给测试服务，以在每个捕获的浏览器上再次运行测试。然后每个浏览器在iframe中加载源文件并处理测试并报告结果给服务。

服务收集捕获的每个浏览器的测试结果并将其呈现给开发者。

#### 工作流概览
karma启动后，加载插件和配置文件，然后启动本地web服务监听连接。任何正在等待该服务的websockets连接的浏览器将会立刻重连。作为加载插件的一部分，测试报告器注册浏览器事件，来准备好报告测试结果。

然后karma启动0/1/2/...号浏览器，设置它们的启动页面为karma服务的url。

当浏览器连接以后，karma提供一个'client.html'文件；当这个文件在浏览器中运行起来以后，它通过websockeds连回服务。

一旦服务收到websocket连接，它通过websocket命令客户端执行测试。客户页面打开一个iframe，从服务加载'context.html'页面。服务通过配置生成这个context.html页面，这个页面包含框架适配器、被测试的代码和测试代码。

当浏览器加载了环境页，环境页的onload事件被触发，onload事件处理通过postMessage连接环境页到服务。框架适配器掌管这些工作；它运行测试，通过消息报告错误或成功

消息发送到客户页面，再通过websocket转发给karma服务。服务作为'浏览器事件'重新分发这些消息。报告器监听'浏览器事件'获取数据；它可能打印出它或保存成文件或传递给另一个服务。因为数据是测试框架适配器发送给报告器的，所以框架适配器和报告器是经常成对出现的，就像karma-jasmine和karma-jasmine-reporter。测试结果的详细内容不关心karma，只有报告器需要知道细节。

karama有很多变更和设置会导致不同的配置有不同的工作流。

## karma-cli
#### karma init
初始化karma并创建karma.conf
#### karma start configFile
开始检测
* configFile 配置文件
#### karma --help
* --help 帮助

## karma.conf
#### 文件匹配规则
在exclude/files/preprocessors三个设置属性中，使用minimatch匹配规则。
#### autoWatch
* cli:--auto-watch --no-auto-watch

是否监视文件改变。

#### autoWatchBatchDelay
开始检测的延迟，毫秒数。告诉karma在最后一次文件改变后，过多长时间开始检测（防抖）。这样能使多个变更同时进行检测。

#### basePath
相对路径的根路径，在files/exclude设置属性中。如果basePath是一个相对路径，它将由__dirname确定。
